# DRF. SPA-Бэкенд приложение университета с курсами, уроками, пользователями и платежами курсов.

# Для начала работы с проектом (с Docker): 
1. Необходимо Создать файл .env на основе .env_exmpl с вашими данными 
* В поля, где данные заполнены '*', нужно ввести свои значения, остальное можете оставить, как в примере.
* В зависимости от того, работаете ли вы с Docker, или без него, можно менять настройки в файле .env

## Для начала работы с проектом (без Docker):
1. Создать и активировать виртуальное окружение 
2. Установить зависимости из requirements.txt : "pip install -r requirements.txt"
3. Создать базу данных
4. Создать файл .env на основе .env_exmpl с вашими данными почты, базы данных
5. Выполнить миграции: "python manage.py makemigrations, python manage.py migrate"
6. Запустить проект с помощью: "python manage.py runserver "

# Docker
* Чтобы собрать Docker-образ, сохраним данный Dockerfile в директории с вашим проектом и выполним команду в терминале:
- docker build -t my-python-app .
Здесь -t my-python-app задает имя образа, а . указывает на текущую директорию с Dockerfile.

После успешной сборки образа вы можете запустить контейнер с помощью команды:
- docker run my-python-app
Таким образом вы запустите ваше Python-приложение в контейнере.

# Docker-Compose
Для запуска через docker-compose введите следующее:
Соберите образ с помощью команды:
- docker-compose build

Запустите контейнеры с помощью команды:
- docker-compose up


## Рекомендации

[//]: # (- Для корректной работы сайта, необходимо создать суперпользователя, и изменить домен в админке &#40;пример: 'http://127.0.0.1:8000/'&#41;)
- Создать суперпользователя можно командой: 'python manage.py csu'
- Создать обычного пользователя можно командой: 'python manage.py cu'
- Для загрузки данных(с очисткой бд) для теста 'python manage.py add_data' (загрузка в бд:юзеров,курсов,уроков,платежей) 

#### Для Postman:

- фильтр:
- /payment/list/?payment_type=transfer
- /payment/list/?course=
- /payment/list/?lesson=
- сорт - /payment/list/?r&ordering=date_of_payment/


## Описание задач

### 24.1 Вьюсеты и дженерики
1. Задание 1
Создайте новый Django-проект, подключите DRF и внесите все необходимые настройки.

2. Задание 2
Создайте следующие модели:

#### Пользователь:
- все поля от обычного пользователя, но авторизацию заменить на email;
- телефон;
- город;
- аватарка.
####  Курс:
- название,
- превью (картинка),
- описание.
#### Урок:
- название,
- описание,
- превью (картинка),
- ссылка на видео.

3. Задание 3
Опишите CRUD для моделей курса и урока, но при этом для курса сделайте через ViewSets, а для урока — через Generic-классы.
Для работы контроллеров опишите простейшие сериализаторы.

4. Дополнительное задание
Реализуйте эндпоинт для редактирования профиля любого пользователя на основе более привлекательного подхода для личного использования: Viewset или Generic.
 


### 24.2 Сериализаторы и фильтры
1. Задание 1
Для модели курса добавьте в сериализатор поле вывода количества уроков.

2. Задание 2
Добавьте новую модель «Платежи» со следующими полями:

#### пользователь,
#### дата оплаты,
#### оплаченный курс или урок,
#### сумма оплаты,
#### способ оплаты: наличные или перевод на счет.
   - Запишите в эту модель данные через инструмент фикстур или кастомную команду.

3. Задание 3
   - Для сериализатора модели курса реализуйте поле вывода уроков.

4. Задание 4
   - Настройте фильтрацию для эндпоинтов вывода списка платежей с возможностями:

   - менять порядок сортировки по дате оплаты,
   - фильтровать по курсу или уроку,
   - фильтровать по способу оплаты.


### 25.1 Права доступа в DRF

1. Задание 1
   - Настройте в проекте использование JWT-авторизации и закройте каждый эндпоинт авторизацией.

2. Задание 2
   - Заведите группу модераторов и опишите для нее права работы с любыми уроками или курсами, но без возможности их удалять и создавать новые. Заложите функционал такой проверки в контроллеры.

3. Задание 3
   - Опишите права доступа для объектов таким образом, чтобы пользователи, которые не входят в группу модераторов, могли видеть и редактировать только свои курсы и уроки.


#### 25.2 Валидаторы, пагинация и тесты

1. Задание 1
   - Для сохранения уроков и курсов реализуйте дополнительную проверку на отсутствие в материалах ссылок на сторонние ресурсы, кроме youtube.com.

   - То есть ссылки на видео можно прикреплять в материалы, а ссылки на сторонние образовательные платформы или личные сайты нельзя.

2. Задание 2
   - Добавьте модель подписки на обновления курса для пользователя.

   - Вам необходимо реализовать эндпоинт для установки подписки пользователя и на удаление подписки у пользователя.

   - При этом при выборке данных по курсу пользователю необходимо присылать признак подписки текущего пользователя на курс. То есть давать информацию, подписан пользователь на обновления курса или нет.

3. Задание 3
   - Реализуйте пагинацию для вывода всех уроков и курсов.

4. Задание 4
   - Напишите тесты, которые будут проверять корректность работы CRUD уроков и функционал работы подписки на обновления курса.

   - Сохраните результат проверки покрытия тестами.


#### 26.1 Документирование и безопасность

1. Задание 1
   - Подключить и настроить вывод документации для проекта. Убедиться, что каждый из реализованных эндпоинтов описан в документации верно, при необходимости описать вручную.

2. Задание 2
   - Подключить возможность оплаты курсов через https://stripe.com/docs/api.

   - Доступы можно получить напрямую из документации, а также пройти простую регистрацию по адресу https://dashboard.stripe.com/register.


#### 26.2. Celery

1. Задание 1
   - Настройте проект для работы с Celery. Также настройте celery-beat для выполнения последующих задач.

2. Задание 2
   - Ранее вы реализовывали функционал подписки на обновление курсов. Теперь добавьте асинхронную рассылку писем пользователям об обновлении материалов курса.

3. Задание 3
   - С помощью celery-beat реализуйте фоновую задачу, которая будет проверять пользователей по дате последнего входа по полю 
   last_login и, если пользователь не заходил более месяца, блокировать его с помощью флага is_active.
